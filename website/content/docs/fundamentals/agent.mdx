---
layout: docs
page_title: Configure a Consul agent
description: >-
  Agent configuration is the process of defining server and client agent properties with CLI flags and configuration files. Learn what properties can be configured on reload and how Consul sets precedence for configuration settings.
---

# Configure a Consul agent

The Consul agent is a long running daemon that operates on a node. It is a core unit of Consul operations. 

Agents can run in either *server mode* or *client mode*. Sever nodes made up the control plane's server cluster, and they are responsible for maintaining the cluster's state. Client nodes are lightweight processes that make up the majority of the cluster. They interface with the server nodes for most operations and maintain little state of their own. Clients run on every node where services are running.

In addition to the core agent operations, server nodes participate in the [consensus quorum](/consul/docs/concept/consensus). The quorum is based on the Raft protocol, which provides strong consistency and availability in the case of failure. Server nodes should run on dedicated instances because they are more resource intensive than client nodes.

## Agent lifecycle

The following process describes the agent lifecycle within the context of an existing cluster:

1. **Start the agent** either manually or through an automated or programmatic process.
   Newly-started agents are unaware of other nodes in the cluster.
1. **An agent joins a cluster**, which enables the agent to discover agent peers.
   Agents join clusters on startup when the [`join`](/consul/commands/join) command is issued or according the [auto-join configuration](/consul/docs/deploy/server/cloud-auto-join).
1. **Information about the agent is gossiped to the entire cluster**.
   As a result, all nodes will eventually become aware of each other.
1. **Existing servers will begin replicating to the new node** if the agent is a server.

### Failures and crashes

In the event of a network failure, some nodes may be unable to reach other nodes.
Unreachable nodes will be marked as _failed_.

Distinguishing between a network failure and an agent crash is impossible.
As a result, agent crashes are handled in the same manner is network failures.

Once a node is marked as failed, this information is updated in the service
catalog.

### Exiting nodes

When a node leaves a cluster, it communicates its intent and the cluster marks the node as having _left_.
In contrast to changes related to failures, all of the services provided by a node are immediately deregistered.
If a server agent leaves, replication to the exiting server will stop.

To prevent an accumulation of dead nodes (nodes in either _failed_ or _left_
states), Consul will automatically remove dead nodes out of the catalog. This
process is called _reaping_. This is currently done on a configurable
interval of 72 hours (changing the reap interval is _not_ recommended due to
its consequences during outage situations). Reaping is similar to leaving,
causing all associated services to be deregistered.

## Agent requirements

You should run one Consul agent per server or host. Instances of Consul can run in separate VMs or as separate containers.

At least one server agent per Consul deployment is required, but three to five server agents are recommended.
Refer to the following sections for information about host, port, memory, and other requirements:

- [Server Performance](/consul/docs/reference/architecture/server)
- [Required Ports](/consul/docs/reference/architecture/ports)

The [Datacenter Deploy tutorial](/consul/tutorials/production-deploy/reference-architecture#deployment-system-requirements) contains additional information, including licensing configuration, environment variables, and other details.

### Maximum latency network requirements

Consul uses the gossip protocol to share information across agents. To function properly, you cannot exceed the protocol's maximum latency threshold. The latency threshold is calculated according to the total round trip time (RTT) for communication between all agents.  Other network usages outside of gossip are not bound by these latency requirements. These uses include client to server RPCs, HTTP API requests, xDS proxy configuration, DNS requests.

Your network must meet the followiong latency requirements for data sent between all Consul agents:

- Average RTT for all traffic cannot exceed 50ms.
- RTT for 99 percent of traffic cannot exceed 100ms.

## Start the Consul agent

Start a Consul agent with the `consul` command and `agent` subcommand using the following syntax:

```shell-session
$ consul agent <options>
```

Agents are highly configurable, which enables you to deploy Consul to any infrastructure.

The minimum information Consul needs to run is the location of a directory for storing agent state data. You can specify the location with the `-data-dir` flag or define the location in an external file and point the file with the `-config-file` flag.

You can also point to a directory containing several configuration files with the `-config-dir` flag.
The configuration directory enables you to logically group configuration settings into separate files.

The following example starts an agent in developer mode and stores agent state data in the `tmp/consul` directory:

```shell-session
$ consul agent -data-dir=tmp/consul -dev
```

Do not use developer mode in production environments.

### Agent startup output

Consul prints several important messages on startup. The following example shows output from the [`consul agent`](/consul/commands/agent) command:

```shell-session
$ consul agent -data-dir=/tmp/consul
==> Starting Consul agent...
==> Consul agent running!
       Node name: 'Armons-MacBook-Air'
      Datacenter: 'dc1'
          Server: false (bootstrap: false)
     Client Addr: 127.0.0.1 (HTTP: 8500, DNS: 8600)
    Cluster Addr: 192.168.1.43 (LAN: 8301, WAN: 8302)

==> Log data will now stream in as it occurs:

    [INFO] serf: EventMemberJoin: Armons-MacBook-Air.local 192.168.1.43
...
```

The agent output includes the following information

- **Node name**: A unique name for the agent. By default, this field
  is the hostname of the machine, but you may customize it using the
  [`-node`](/consul/docs/agent/config/cli-flags#_node) flag.

- **Datacenter**: The datacenter where the agent is configured to
  run. For single-DC configurations, the agent defaulta to `dc1`, but you can configure which datacenter the agent reports to with the [`-datacenter`](/consul/docs/agent/config/cli-flags#_datacenter) flag. Consul has first-class support for multiple datacenters, but configuring each node to report its datacenter improves agent efficiency.

- **Server**: Indicates whether the agent is running in server or client
  mode. Running an agent in server mode requires additional resource overhead because they participate in the consensus quorum, store cluster state, and handle queries. A server may also be in ["bootstrap"](/consul/docs/agent/config/cli-flags#_bootstrap_expect) mode, which enables the server to elect itself as the Raft leader. Multiple servers cannot be in bootstrap mode because it would put the cluster in an inconsistent state.

- **Client Addr**: The address used for clients to interface with the agent, including the ports for the HTTP and DNS interfaces. By default, this address
  binds only to localhost. If you change this address or port, specify a `-http-addr` whenever you run commands such as [`consul members`](/consul/commands/members) to indicate how to reach the agent. Other applications can also use the HTTP address and port [to control Consul with the HTTP API](/consul/api-docs).

- **Cluster Addr**: The address and set of ports used for communication between Consul agents in a cluster. Not all Consul agents in a cluster have to use the same port, but this address **MUST** be reachable by all other nodes.

When running under `systemd` on Linux, Consul sends `READY=1` to the `$NOTIFY_SOCKET` when a LAN join completes. Either the `join` or `retry_join` option has to be set and the service definition file has to have `Type=notify` set for this notification to send.

## Configure Consul agents

You can configure Consul agents with the Consul CLI's `consul agent` command or define them in agent configuration files. The following example starts a Consul agent that takes configuration settings from a file called `server.json` located in the current working directory:

```shell-session hideClipboard
$ consul agent -config-file=server.json
```

Configuration precedence is evaluated in the following order:

1. [Command line arguments](/consul/docs/reference/agent/cli-flags)
1. [Configuration files](/consul/docs/reference/agent/configuration-file)

The Consul agent loads the configuration from files and directories in lexical order. For example, configuration file `basic_config.json` is processed before `extra_config.json`. Configuration can be in either [HCL](https://github.com/hashicorp/hcl#syntax) or JSON format.

Configurations specified later are be merged into configuration specified earlier. In most cases, "merge" means that the later version overrides the
earlier. In some cases, such as event handlers, merging appends the handlers to the existing configuration. The exact merging behavior is specified for each option.

The Consul agent also supports reloading configuration when it receives the SIGHUP signal. Not all changes are respected. The [reload command](/consul/commands/reload) can also be used to trigger a configuration reload.

### Common configuration settings

The following settings are commonly used in the agent configuration file to configure Consul agents:

| Parameter    | Description                                                                                                                                                                                                                                                                | Default                                                                                                          |
| ------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| `node_name`  | String value that specifies a name for the agent node. <br/>See [`-node-id`](/consul/docs/agent/config/cli-flags#_node_id) for details.                                                                                                                                                    | Hostname of the machine                                                                                          |
| `server`     | Boolean value that determines if the agent runs in server mode. <br/>See [`-server`](/consul/docs/agent/config/cli-flags#_server) for details.                                                                                                                                             | `false`                                                                                                          |
| `datacenter` | String value that specifies which datacenter the agent runs in. <br/>See [-datacenter](/consul/docs/agent/config/cli-flags#_datacenter) for details.                                                                                                                                       | `dc1`                                                                                                            |
| `data_dir`   | String value that specifies a directory for storing agent state data. <br/>See [`-data-dir`](/consul/docs/agent/config/cli-flags#_data_dir) for details.                                                                                                                                   | none                                                                                                             |
| `log_level`  | String value that specifies the level of logging the agent reports. <br/>See [`-log-level`](/consul/docs/agent/config/cli-flags#_log_level) for details.                                                                                                                                    | `info`                                                                                                           |
| `retry_join` | Array of string values that specify one or more agent addresses to join after startup. The agent will continue trying to join the specified agents until it has successfully joined another member. <br/>See [`-retry-join`](/consul/docs/agent/config/cli-flags#_retry_join) for details. | none                                                                                                             |
| `addresses`  | Block of nested objects that define addresses bound to the agent for internal cluster communication.                                                                                                                                                                       | `"http": "0.0.0.0"` See the Agent Configuration page for [default address values](/consul/docs/reference/agent/configuration-file#addresses) |
| `ports`      | Block of nested objects that define ports bound to agent addresses. <br/>See (link to addresses option) for details.                                                                                                                                                       | See the Agent Configuration page for [default port values](/consul/docs/reference/agent/configuration-file#ports)                            |

## Reloadable configurations

Some agent configuration options are reloadable at runtime.

You can run the [`consul reload` command](/consul/commands/reload) to manually reload supported options from configuration files in the configuration directory. To configure the agent to automatically reload configuration files updated on disk, set the [`auto_reload_config` configuration option](/consul/docs/reference/agent/configuration-file#auto_reload_config) parameter to `true`.

The following agent configuration options are reloadable at runtime: 
- ACL tokens
- Bootstrapped configuration entries
- Health check definitions
- [Discard Check Output](/consul/docs/reference/agent/configuration-file#discard_check_output)
- HTTP client address
- Log level
- [Metric Prefix Filter](/consul/docs/reference/agent/configuration-file#telemetry-prefix_filter)
- [Node Metadata](/consul/docs/reference/agent/configuration-file#node_meta)
- Some Raft options:
  - [`raft_snapshot_threshold`](/consul/docs/reference/agent/configuration-file#_raft_snapshot_threshold)
  - [`raft_snapshot_interval`](/consul/docs/reference/agent/configuration-file#_raft_snapshot_interval)
  - [`raft_trailing_logs`](/consul/docs/reference/agent/configuration-file#_raft_trailing_logs)
- [RPC rate limits](/consul/docs/reference/agent/configuration-file#limits)
- [Reporting](/consul/docs/reference/agent/configuration-file#reporting)
- [HTTP maximum connections per client](/consul/docs/reference/agent/configuration-file#http_max_conns_per_client)
- Service definitions
- TLS configuration. Be aware that this is currently limited to reload a configuration that is already TLS enabled. You cannot enable or disable TLS only with reloading. To avoid a potential security issue, the following TLS configuration parameters do not automatically reload when [-auto-reload-config](/consul/docs/agent/config/cli-flags#_auto_reload_config) is enabled:
  - [encrypt_verify_incoming](/consul/docs/reference/agent/configuration-file#encrypt_verify_incoming)
  - [verify_incoming](/consul/docs/reference/agent/configuration-file#verify_incoming)
  - [verify_incoming_rpc](/consul/docs/reference/agent/configuration-file#verify_incoming_rpc)
  - [verify_incoming_https](/consul/docs/reference/agent/configuration-file#verify_incoming_https)
  - [verify_outgoing](/consul/docs/reference/agent/configuration-file#verify_outgoing)
  - [verify_server_hostname](/consul/docs/reference/agent/configuration-file#verify_server_hostname)
  - [ca_file](/consul/docs/reference/agent/configuration-file#ca_file)
  - [ca_path](/consul/docs/reference/agent/configuration-file#ca_path)
- [License](/consul/docs/enterprise/license)

## Stop an agent

An agent can be stopped in two ways: gracefully or forcefully. Servers and
Clients both behave differently depending on the leave that is performed. There
are two potential states a process can be in after a system signal is sent:
_left_ and _failed_.

To gracefully halt an agent, send the process an _interrupt signal_ (usually
`Ctrl-C` from a terminal, or running `kill -INT consul_pid` ). For more
information on different signals sent by the `kill` command, see
[here](https://www.linux.org/threads/kill-signals-and-commands-revised.11625/)

When a Client is gracefully exited, the agent first notifies the cluster it
intends to leave the cluster. This way, other cluster members notify the
cluster that the node has _left_.

When a server gracefully exits, the server will not be marked as _left_.
This is to minimally impact the consensus quorum. Instead, the Server will be
marked as _failed_. To remove a server from the cluster, the
[`force-leave`](/consul/commands/force-leave) command is used. Using
`force-leave` will put the server instance in a _left_ state so long as the
Server agent is not alive.

Alternatively, you can forcibly stop an agent by sending it a
`kill -KILL consul_pid` signal. This will stop any agent immediately. The rest
of the cluster will eventually (usually within seconds) detect that the node has
died and notify the cluster that the node has _failed_.

For client agents, the difference between a node _failing_ and a node _leaving_
may not be important for your use case. For example, for a web server and load
balancer setup, both result in the same outcome: the web node is removed
from the load balancer pool.

The [`skip_leave_on_interrupt`](/consul/docs/reference/agent/configuration-file#skip_leave_on_interrupt) and
[`leave_on_terminate`](/consul/docs/reference/agent/configuration-file#leave_on_terminate) configuration
options allow you to adjust this behavior.

## Next steps

Next, learn about the [fundamentals of services in Consul](/consul/docs/fundamentals/service)/